var PRS$0=function(t,e){return t.__proto__={a:e},t.a===e}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(t,e){for(var n in e)e.hasOwnProperty(n)&&DP$0(t,n,GOPD$0(e,n));return t},SP$0=Object.setPrototypeOf||function(t,e){return PRS$0?t.__proto__=e:DP$0(t,"__proto__",{value:e,configurable:!0,enumerable:!1,writable:!0}),t},OC$0=Object.create;global.Towns={},module.exports=global.Towns;var T=global.Towns,r=console.log.bind(console);T.setNamespace=function(t){t=t.split(".");for(var e,n=this,r=0,i=t.length;i>r;r++){if(e=t[r],"T"===e)throw new Error("Cant set namespace T under T!");"undefined"==typeof n[e]?(n[e]={},n=n[e]):n=n[e]}return!0},T.Color=function(){"use strict";function t(t,e,n){var r=arguments[3];void 0===r&&(r=255),this.r=t,this.g=e,this.b=n,this.a=r}var e={},n={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.bounds=function(){this.r=Math.round(this.r),this.g=Math.round(this.g),this.b=Math.round(this.b),this.a=Math.round(this.a),this.r>255&&(this.r=255),this.r<0&&(this.r=0),this.g>255&&(this.g=255),this.g<0&&(this.g=0),this.b>255&&(this.b=255),this.b<0&&(this.b=0),this.a>255&&(this.a=255),this.a<0&&(this.a=0)},n.getCssColor=function(){return this.bounds(),255==this.a?"rgb("+this.r+", "+this.g+", "+this.b+")":"rgba("+this.r+", "+this.g+", "+this.b+", "+Math.round(this.a/255*100)/100+")"},n.getHex=function(){return this.bounds(),"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},e.createFromHex=function(t){var e,n;if(n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,t=t.replace(n,function(t,e,n,r){return e+e+n+n+r+r}),e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))return new T.Color(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16));throw new Error("Error while creating T.Color from "+t)},MIXIN$0(t,e),MIXIN$0(t.prototype,n),e=n=void 0,t}(),T.Path=function(){"use strict";function t(){if(this.array_position_date=Array.prototype.slice.call(arguments),this.array_position_date.length<2)throw new Error("Thare must be at least 2 params when constructing T.Path.");for(var t,e=-1,n=0,r=this.array_position_date.length;r>n;n++){if(t=this.array_position_date[n],!(t instanceof T.PositionDate))throw new Error("All Params when constructing T.Path must be T.PositionDate");if(e>=t.date)throw new Error("Dates should be consecutive when constructing T.Path.");e=t.date}}var e={},n={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.newConstantSpeed=function(t,e){var n=arguments[2];if(void 0===n&&(n=0),0===n?n=new Date:"number"==typeof n&&(n=new Date(n)),t.length<2)throw new Error("Thare must be at least 2 params when constructing T.Path.");for(var r,i,o=[new T.PositionDate(t[0].x,t[0].y,n)],a=t[0],s=1,u=t.length;u>s;s++){if(r=t[s],!(r instanceof T.Position))throw new Error("All Params when constructing T.Path via newConstantSpeed must be T.Position");i=a.getDistance(r),n=new Date(n+i/e*1e3),a=r,o.push(new T.PositionDate(t[s].x,t[s].y,n))}return new this.apply(this,o)},n.countSegment=function(t){if(this.array_position_date[0].date>t)return 0;if(this.array_position_date[this.array_position_date.length-1].date<=t)return this.array_position_date.length-1;for(var e,n,r=0,i=this.array_position_date.length-1;i>r;r++)if(e=this.array_position_date[r],n=this.array_position_date[r],e.date<=t&&n.date>t)return r;throw new Error("Error while counting segment in T.Path")},n.countPosition=function(t){if(this.array_position_date[0].date>t)return this.array_position_date[0].getPosition();if(this.array_position_date[this.array_position_date.length-1].date<=t)return this.array_position_date[this.array_position_date.length-1].getPosition();var e=this.countSegment(t);return A=this.array_position_date[e],B=this.array_position_date[e+1],x=T.Math.proportions(A.date,t,B.date,A.x,B.x),y=T.Math.proportions(A.date,t,B.date,A.y,B.y),new T.Position(x,y)},n.countRotation=function(t){var e=this.countSegment(t);A=this.array_position_date[e],B=this.array_position_date[e+1],B.getPosition().moveBy(A.getPosition().multiply(-1));var n=B.getPositionPolar();return n.getDegrees()},n.countSpeed=function(t){var e=this.countSegment(t);A=this.array_position_date[e],B=this.array_position_date[e+1];var n=A.getDistance(B),r=B.date-A.date;return n/r},n.inProgress=function(t){return this.array_position_date[0].date>t?!1:!(this.array_position_date[this.array_position_date.length-1].date<=t)},n.toString=function(){return this.array_position_date.join(", ")},MIXIN$0(t,e),MIXIN$0(t.prototype,n),e=n=void 0,t}(),T.PathX=function(){"use strict";function t(t,e,n,r,i){var o,a,s;if(this.positions=[],r[Math.round(e.y)-i.y][Math.round(e.x)-i.x]===!1)throw"Wrong Destination";T.ArrayFunctions.iterate2D(r,function(t,e){r[t][e]!==!1&&(r[t][e]=!0)}),r[Math.round(t.y)-i.y][Math.round(t.x)-i.x]=0;for(var u=function(t,e){if("number"==typeof r[t][e]&&r[t][e]>=0)for(var n=t-1;t+1>=n;n++)for(var i=e-1;e+1>=i;i++)if((r[n][i]===!0||2>l)&&(i==e?n!=t:n==t)&&(i!=e||n!=t)&&i>=0&&n>=0&&i<2*map_radius&&n<2*map_radius){var o=T.Math.xy2dist(n-t,i-e);(r[n][i]===!0||2>l)&&(r[n][i]=-(r[t][e]+o))}},c=function(t,e){"number"==typeof r[t][e]&&(r[t][e]=Math.abs(r[t][e]))},h=!1,l=0;100>l&&!h;l++)T.ArrayFunctions.iterate2D(r,u),T.ArrayFunctions.iterate2D(r,c),"number"==typeof r[Math.round(e.y)-i.y][Math.round(e.x)-i.x]&&(h=!0);if(!h)throw"Cant find path";h=!1;var f=Math.round(e.x)-i.x,p=Math.round(e.y)-i.y;for(l=0;20>l&&!h;l++){0!==l&&this.positions.push(new T.Position(f+i.x,p+i.y)),o=0,a=!1,s=!1;for(var d=p-1;p+1>=d;d++)for(var y=f-1;f+1>=y;y++)y==f&&s==p||y>=0&&d>=0&&y<2*map_radius&&d<2*map_radius&&"number"==typeof r[d][y]&&r[p][f]-r[d][y]>=o&&(o=r[p][f]-r[d][y],a=y,s=d);if(a===!1||s===!1)throw new Error("Error in path",a,s);f=a,p=s,f==Math.round(t.x)-i.x&&p==Math.round(t.y)-i.y&&(h=!0)}this.positions.push(t),this.positions.reverse(),this.positions.push(e),this.times=[new Date];for(var g=this.times[0].getTime(),m=1,b=this.positions.length;b>m;m++)o=T.Math.xy2dist(this.positions[m].x-this.positions[m-1].x,this.positions[m].y-this.positions[m-1].y),g+=Math.round(1e3*o/n),this.times.push(new Date(g))}var e={},n={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.recount=function(){for(var t=new Date,e=t.getTime(),n=0,r=this.times.length-1;r>n;n++){var i=this.times[n].getTime(),o=this.times[n+1].getTime();if(e>=i&&o>e){var a=(e-i)/(o-i),s=this.positions[n+1].x-this.positions[n].x,u=this.positions[n+1].y-this.positions[n].y;return new T.Position(this.positions[n].x+s*a,this.positions[n].y+u*a)}}return!1},n.rotation=function(){for(var t=new Date,e=t.getTime(),n=0,r=this.times.length-1;r>n;n++){var i=this.times[n].getTime(),o=this.times[n+1].getTime();if(e>=i&&o>e){var a=this.positions[n+1].x-this.positions[n].x,s=this.positions[n+1].y-this.positions[n].y,u=T.Math.xy2distDeg(s,a);return u.deg+90}}return!1},n.inProgress=function(){var t=this.times[this.times.length-1],e=new Date,n=e.getTime();return t>n},e.is=function(t){return is(t)&&is(t.inProgress)?!!t.inProgress():!1},MIXIN$0(t,e),MIXIN$0(t.prototype,n),e=n=void 0,t}(),T.Position3D=function(){"use strict";function t(t,e,n){"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=n)}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.clone=function(){return new T.Position3D(this)},e.toString=function(){return"["+this.x+","+this.y+","+this.z+"]"},MIXIN$0(t.prototype,e),e=void 0,t}(),T.PositionPolar=function(){"use strict";function t(t,e){"number"==typeof t&&"number"==typeof e&&(this.distance=t,this.degrees=e)}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.clone=function(){return new T.PositionPolar(this)},e.getPosition=function(){var t=this.getRadians();return new T.Position(Math.cos(t)*this.distance,Math.sin(t)*this.distance)},e.getDistance=function(){return this.distance},e.getDegrees=function(){return this.degrees},e.getRadians=function(){return T.Math.deg2rad(this.degrees)},e.toString=function(){return""+this.distance+","+this.degrees+"°"},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Position=function(){"use strict";function t(t,e){"object"==typeof t?(this.x=t.x,this.y=t.y):/^[+-]?\d+(\.\d+)?,[+-]?\d+(\.\d+)?$/.test(t)?(t=t.split(","),this.x=parseFloat(t[0]),this.y=parseFloat(t[1])):"number"==typeof t&&"number"==typeof e&&(this.x=t,this.y=e)}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.clone=function(){return new T.Position(this)},e.plus=function(t){return this.x+=t.x,this.y+=t.y,this},e.multiply=function(t){return this.x=this.x*t,this.y=this.y*t,this},e.getPositionPolar=function(){return new T.PositionPolar(T.Math.xy2dist(this.x,this.y),T.Math.rad2deg(Math.atan2(this.y,this.x)))},e.getDistance=function(t){return T.Math.xy2dist(t.x-this.x,t.y-this.y)},e.toString=function(){return""+this.x+","+this.y},MIXIN$0(t.prototype,e),e=void 0,t}(),T.PositionDate=function(t){"use strict";function e(e,n){var r=arguments[2];if(void 0===r&&(r=0),t.call(this,e,n),0===r?r=new Date:"number"==typeof r&&(r=new Date(r)),isNaN(r+1))throw new Error("To construct PositionDate is needed valid Date not "+r+" "+r/1+".");this.date=r}t=T.Position,PRS$0||MIXIN$0(e,t);var n={};return null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.clone=function(){return new T.PositionDate(this)},n.getPosition=function(){return new T.Position(this.x,this.y)},n.toString=function(){return"["+this.x+","+this.y+"] at "+this.date},MIXIN$0(e.prototype,n),n=void 0,e}(),T.ArrayFunctions=function(){"use strict";function t(){}DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1});var e={};return e.id2i=function(t,e){for(var n in t)if(t[n].id==e)return n;return-1},e.id2item=function(t,e){var n=arguments[2];void 0===n&&(n=!1);for(var r in t)if(t[r].id==e)return t[r];if(n)throw new Error(n);return null},e.idRemove=function(t,e){for(var n in t)if(t[n].id==e)return t.splice(n,1),!0;return!1},e.iterate2D=function(t,e){for(var n=0,r=t.length;r>n;n++)for(var i=0,o=t[n].length;o>i;i++)e(n,i)},e.removeItems=function(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,r)},e.filterPath=function(t,e,n){if(!is(t))throw new Error("filterPath: Object is undefined.");if(!is(e.forEach))throw r(e),new Error("filterPath: T.Path is not correct array.");for(var i in e){var o=e[i];if(!(i<e.length-1||"undefined"==typeof n))return t[o]=n,!0;if("undefined"==typeof t[o])return;t=t[o]}return t},e.unique=function(t){for(var e={},n=[],r=0;r<t.length;r++)e[t[r]]||(e[t[r]]=t,n.push(t[r]));return n},e.array2table=function(t){var e=arguments[1];void 0===e&&(e="");var n="",r=t.length,i=t[0].length;n+='<table class="'+e+'">';for(var o=0;r>o;o++){n+="<tr>";for(var a=t[o].length,s=i-a,u=0;a>u;u++)n+=u==a-1&&0!==s?'<td colspan="'+(s+1)+'">':"<td>",n+=t[o][u],n+="</td>";n+="</tr>"}return n+="</table>"},e.getKeys=function(t){var e=[];for(var n in t)e.push(n);return e},MIXIN$0(t,e),e=void 0,t}(),T.Game=function(){"use strict";function t(t,e){this.action_classes={},this.action_empty_instances={},this.max_life_modifier=t,this.price_key_modifier=e}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getObjectPriceBases=function(t){var e=[];return 0===typeof t.actions.length&&console.warn("In object "+t+" there are no actions!"),t.actions.forEach(function(t){var n=Math.ceil(t.countPriceBase());if(isNaN(n)&&(console.warn("Params in action ability "+t.type+" makes price bese NaN."),n=0),0>n)throw new Error("Params in action ability "+t.type+" should not make this action negative");e.push(n)}),e},e.getObjectMaxLife=function(t){var e=this.getObjectPriceBases(t),n=e.reduce(function(t,e){return t+e},0);return n=this.max_life_modifier(n)},e.getObjectPrices=function(t){var e=this.getObjectPriceBases(t),n=[],r=t.getModel().aggregateResourcesVolumes();return t.actions.forEach(function(t,i){var o=t.getPriceResources().sort(function(t,e){return r.compare(t.clone().signum())-r.compare(e.clone().signum())}),a=o[0].clone();a.multiply(e[i]),n.push(a)}),n},e.getObjectPrice=function(t){var e=new T.Resources({}),n=this.getObjectPrices(t);return n.forEach(function(t){e.add(t)}),e.apply(this.price_key_modifier),e},e.installActionClass=function(t,e){var n=e.getType();if("string"!=typeof n)throw new Error("Error while installing action class into game instance: action class has no type!");if("undefined"!=typeof this.action_classes[n])throw new Error("Error while installing action class into game instance: there is already installed action with type "+n);var r=new e({type:n,params:t});e.prototype.clone=function(){return new e(JSON.parse(JSON.stringify(this)))},this.action_classes[n]=e,this.action_empty_instances[n]=r},e.getActionClass=function(t){var e=this.action_classes[t];if("undefined"==typeof e)throw new Error("In this game instance thare is no action class type "+t+". There are only these action types: "+T.ArrayFunctions.getKeys(this.action_classes).join(", "));return e},e.newActionInstance=function(t){"defense"===t.type&&(t.type="defence",t.params.defence=t.params.defense,delete t.params.defense);var e=this.getActionClass(t.type);return new e(t)},e.createActionExecute=function(t){var e=this,n=this.getActionClass(t),r=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(e),n.execute.apply(this,t)};return r},e.getActionEmptyInstance=function(t){var e=this.action_empty_instances[t];if("undefined"==typeof e)throw new Error("In this game instance thare is no action class type "+t);return e},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Game.Action=function(){"use strict";function t(t){if("undefined"==typeof this.constructor.getType)throw new Error("You must extend T.Game.Action and add method getType before creating instances!");var e=this.constructor.getType();if(t.type!==e)throw new Error("This is "+e+" not "+t.type+" class!");for(var n in t){var r=n;this[r]=t[n]}}var e={},n={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.countPriceBase=function(){return 0},n.getPriceResources=function(){return[]},e.execute=function(){throw new Error("You can not execute passive action.")},n.canBeExecutedIn=function(){if("number"==typeof this.params.cooldown){if("undefined"==typeof this.last_use)return 0;var t=Math.abs(this.last_use-new Date)/1e3;return this.params.cooldown<=t?0:this.params.cooldown-t}return 0},n.canBeExecutedNow=function(){return 0===this.canBeExecutedIn()},n.nowExecuted=function(){this.last_use=new Date},n.createHtmlProfile=function(){var t='<table class="action-ability-profile">';t+='\n            <tr>\n                <th colspan="2">'+T.Locale.get("object","action",this.type)+"</th>\n            </tr>\n            ","undefined"!=typeof this.last_use&&(t+="\n            <tr>\n                <td>"+T.Locale.get("object","action","last_used")+"</td>\n                <td>"+this.last_use+"</td>\n            </tr>\n            ");for(var e in this.params)t+="\n            <tr>\n                <td>"+T.Locale.get("object","action",this.type,e)+"</td>\n                <td>"+this.params[e]+"</td>\n            </tr>\n            ";return t+="</table>"},MIXIN$0(t,e),MIXIN$0(t.prototype,n),e=n=void 0,t}(),T.MapGenerator=function(){"use strict";function t(t,e,n,r){this.getZ=t,this.z_normalizing_table=e,this.biotope=n,this.virtualObjectGenerator=r}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getZMapCircle=function(t,e){for(var n=[],r=0;2*e>=r;r++){n[r]=[];for(var i=0;2*e>=i;i++)if(!(Math.pow(i-e+.5,2)+Math.pow(r-e+.5,2)>Math.pow(e,2))){var o=this.getZ(i-e+t.x,r-e+t.y);n[r][i]=this.z_normalizing_table[Math.floor(o*this.z_normalizing_table.length)]}}return n},e.terrainMap=function(t){for(var e=[],n=0,r=t.length;r>n;n++){e[n]=[];for(var i=0;r>i;i++)"undefined"!=typeof t[n][i]&&(e[n][i]=this.biotope.getZTerrain(t[n][i]))}return e},e.getMapArrayCircle=function(t,e){var n=this.getZMapCircle(t,e),r=this.terrainMap(n);return r},e.convertMapArrayToObjects=function(t,e,n){for(var r=new T.Objects.Array,i=0;2*n>i;i++)for(var o=0;2*n>o;o++)if("undefined"!=typeof t[i][o]){var a=new T.Objects.Terrain(t[i][o]);a.x=e.x-n+o,a.y=e.y-n+i,r.push(a)}return r},e.getPureMap=function(t,e){var n=arguments[2];void 0===n&&(n=!1);var r={x:Math.floor(t.x),y:Math.floor(t.y)};n&&(n={x:n.x-r.x,y:n.y-r.y});var i,o,a,s,u,c=new T.Objects.Array;for(o=0;2*e>=o;o++)for(i=0;2*e>=i;i++)Math.pow(i-e+.5,2)+Math.pow(o-e+.5,2)>Math.pow(e,2)||n&&Math.pow(i-n.x-e+.5,2)+Math.pow(o-n.y-e+.5,2)<=Math.pow(e,2)||(a=this.getZ(i-e+r.x,o-e+r.y),a=this.z_normalizing_table[Math.floor(a*this.z_normalizing_table.length)],s=this.biotope.getZTerrain(a),u=new T.Objects.Terrain(s),u.x=r.x-e+i,u.y=r.y-e+o,c.push(u));return c},e.getVirtualObjectsFromTerrainObjects=function(t){for(var e=[],n=t.get1x1TerrainObjects().getAll(),r=0,i=n.length;i>r;r++)this.virtualObjectGenerator(n[r],e);return e},e.getCompleteObjects=function(t,e,n){var r=arguments[3];void 0===r&&(r=!0);var i=arguments[4];void 0===i&&(i=!1);var o=this.getPureMap(e,n,i);if(t.forEach(function(t){o.push(t)}),r){var a=this.getVirtualObjectsFromTerrainObjects(o);a.forEach(function(t){o.push(t)})}return o},MIXIN$0(t.prototype,e),e=void 0,t}(),T.MapGenerator.Biotope=function(){"use strict";function t(t){var e=0;t.forEach(function(t){e+=t.amount});var n=0;t.forEach(function(t){t.from=n/e,n+=t.amount}),this.terrains=t}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getZTerrain=function(t){for(var e=this.terrains.length-1;e>=0;e--)if(t>=this.terrains[e].from)return this.terrains[e].terrain},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Math=function(){"use strict";function t(){}DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1});var e={};return e.sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},e.baseLog=function(t,e){return Math.log(e)/Math.log(t)},e.prettyNumber=function(t,e){e=e||2;var n=Math.ceil(T.Math.baseLog(10,t)),r=Math.pow(10,e-n);return t*=r,t=Math.round(t),t/=r},e.angleDiff=function(t,e){var n=Math.abs(t-e)%360;return n>180&&(n=360-n),n},e.rad2deg=function(t){return t*(180/Math.PI)%360},e.deg2rad=function(t){return t%360*(Math.PI/180)},e.xy2dist=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},e.xy2distDeg=function(t,e){var n={};return n.dist=this.xy2dist(t,e),n.deg=this.rad2deg(Math.atan2(e,t)),n},e.distDeg2xy=function(t,e){var n=this.deg2rad(e),r={};return r.x=Math.cos(n)*t,r.y=Math.sin(n)*t,r},e.xyRotate=function(t,e,n){var r=this.xy2dist(t,e),i=Math.atan2(e,t);i+=this.deg2rad(n);var o={};return o.x=Math.cos(i)*r,o.y=Math.sin(i)*r,o},e.randomSeedPosition=function(t,e){return(Math.sin(Math.pow(e.x*e.y-t,2))+1)/2},e.toFloat=function(t,e){return"undefined"==typeof e&&(e=0),"undefined"==typeof t?e:(t=parseFloat(t),isNaN(t)?e:t)},e.toInt=function(t,e){return"undefined"==typeof t?e:(t=parseInt(t),isNaN(t)?e:t)},e.bounds=function(t,e,n){return e>t?e:t>n?n:t},e.isOnLine=function(t,e,n,r,i,o){n-=t,r-=e,i-=t,o-=e;var a=r/n,s=o/i;if(a!=s)return!1;var u=this.xy2dist(r,n),c=this.xy2dist(o,i);return u>=c},e.lineCollision=function(t,e,n,r,i,o,a,s){var u,c=(n-t)*(s-o)-(r-e)*(a-i),h=(e-o)*(a-i)-(t-i)*(s-o),l=(e-o)*(n-t)-(t-i)*(r-e);if(0===c){var f=this.isOnLine(t,e,n,r,i,o),p=this.isOnLine(i,o,a,s,t,e);return f||p}var d=h/c,y=l/c;return u=d>=0&&1>=d&&y>=0&&1>=y},e.blurXY=function(t,e){return function(n,r){var i,o,a=0,s=0;for(i=n-e;n+e>=i;i++)for(o=r-e;r+e>=o;o++)Math.pow(e,2)<Math.pow(i-n,2)+Math.pow(o-r,2)||(a+=t(i,o),s++);return a/s}},e.bytesToSize=function(t){var e=["B","KB","MB","GB","TB"];if(0===t)return"0B";var n=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.round(t/Math.pow(1024,n),2)+""+e[n]},e.proportions=function(t,e,n,r,i){var o=n-t,a=i-r,s=n-e,u=a*s/o;return i-u},MIXIN$0(t,e),e=void 0,t}(),T.Model=function(){"use strict";function t(t){return"undefined"==typeof t?!1:(this.name=t.name,this.particles=t.particles,this.rotation=t.rotation,this.size=t.size,"undefined"==typeof this.rotation&&(this.rotation=0),void("undefined"==typeof this.size&&(this.size=1)))}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.clone=function(){return new T.Model(JSON.parse(JSON.stringify(this)))},e.addRotationSize=function(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=1),this.rotation+=t,this.size=this.size*e},e.range=function(t){if("xy"==t)return T.Math.xy2dist(this.range("x"),this.range("y")*this.size);var e,n,r=this.getLinearParticles(),i=!1,o=!1;for(var a in r)n=r[a].position[t],e=r[a].position[t]+r[a].size[t],i===!1&&(i=e),o===!1&&(o=n),e>i&&(i=e),o>n&&(o=n);return Math.abs(o-i)},e.moveBy=function(t,e,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=0);for(var r in this.particles)this.particles[r].position.x+=t,this.particles[r].position.y+=e,this.particles[r].position.z+=n},e.joinModelZ=function(t,e,n){var i=this.getLinearParticles(),o=t.getLinearParticles(),a=[0];for(var s in o){o[s].position.x+=e,o[s].position.y+=n;for(var u in i)Particles.collision2D(i[u],o[s])&&(r(i[u],o[s]),a.push(i[u].position.z+i[u].size.z))}var c=Math.max.apply(Math,a);return c},e.joinModel=function(t,e,n){var r=this.joinModelZ(t,e,n);this.particles=[JSON.parse(JSON.stringify(this)),JSON.parse(JSON.stringify(t))],this.particles[1].position={x:e,y:n,z:r},this.rotation=0,this.size=1},e.getDeepCopyWithoutLinks=function(){var t=this.clone(),e=function(t,n){for(var r in t){if(t[r].name==n)return t[r];if("undefined"!=typeof t[r].particles){var i=e(t[r].particles,n);if(i!==!1)return i}}return!1},n=function(r){for(var i in r){if("undefined"!=typeof r[i].link){var o=e(t.particles,r[i].link);if(o===!1)throw new Error("Invalid link "+particle.link);o=JSON.parse(JSON.stringify(o)),"undefined"!=typeof r[i].rotation&&(o.rotation=r[i].rotation),"undefined"!=typeof r[i].size&&(o.size=r[i].size),"undefined"!=typeof r[i].position&&(o.position=r[i].position),r[i]=o}"undefined"!=typeof r[i].particles&&n(r[i].particles)}};return n(t.particles),t},e.getLinearParticles=function(){var t=[],e=function(n,r,i,o){"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=1),r===!1&&(r={x:0,y:0,z:0}),n.forEach(function(n){n.position||(n.position={x:0,y:0,z:0}),"undefined"==typeof n.rotation&&(n.rotation=0),"undefined"==typeof n.size&&(n.size=1);var a=T.Math.xy2distDeg(n.position.x,n.position.y);a.dist=a.dist*o,a.deg+=i;var s=T.Math.distDeg2xy(a.dist,a.deg);n.rotation+=i,n.position.x=s.x,n.position.y=s.y,n.position.z=n.position.z*o,n.position.x+=r.x,n.position.y+=r.y,n.position.z+=r.z,"number"==typeof n.size?n.size=n.size*o:(n.size.x=n.size.x*o,n.size.y=n.size.y*o,n.size.z=n.size.z*o),"undefined"!=typeof n.particles?e(n.particles,n.position,n.rotation,n.size):"undefined"!=typeof n.shape&&t.push(n)})},n=this.getDeepCopyWithoutLinks();return e(n.particles,!1,n.rotation,n.size),t},e.filterPath=function(t){var e=this;if("undefined"==typeof t.forEach)throw r(t),new Error("Path is not correct array.");return t.forEach(function(t){e=e.particles[t]}),e},e.filterPathSiblings=function(t){var e=this.getDeepCopyWithoutLinks(),n=e;if("undefined"==typeof t.forEach)throw r(t),new Error("Path is not correct array.");return t.forEach(function(t,e){var r=n.particles[t];n.particles=[r],n=r}),e},e.aggregateResourcesVolumes=function(){var t=new T.Resources({}),e=this.getLinearParticles();return e.forEach(function(e){var n=e.size.x*e.size.y*e.size.z,r=e.material.split("_");r=r[0];var i={};i[r]=n,t.add(i)}),t},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Model.Particles=function(){"use strict";function t(){}DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1});var e={};return e.addMissingParams=function(t){return"undefined"==typeof t.skew&&(t.skew={}),"undefined"==typeof t.skew.z&&(t.skew.z={x:0,y:0}),"undefined"==typeof t.shape.top&&(t.shape.top=1),"undefined"==typeof t.shape.bottom&&(t.shape.bottom=1),"undefined"==typeof t.rotation&&(t.rotation=0),t},e.get3D=function(t){var e={};if(t=this.addMissingParams(t),"prism"!=t.shape.type)throw"Unknown particle shape "+t.shape.type;var n=t.position.x,r=t.position.y,i=t.position.z,o=t.size.x,a=t.size.y,s=t.size.z;e.points=[],e.polygons=[[],[]],e.polygons2D=[[],[]];for(var u,c=0;2>c;c++){u=0===c?t.shape.bottom:t.shape.top;for(var h,l,f,p=0;p<t.shape.n;p++){if(is(t.shape.rotated)){var d=2-Math.cos(T.Math.deg2rad(180/t.shape.n));h=o*(2*c-1),l=.5*a*Math.sin(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n)),f=.5*(s*Math.cos(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*d+s*Math.cos(T.Math.deg2rad(180/t.shape.n))*d)}else h=.5*o*Math.cos(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*u+o*(c*t.skew.z.x),l=.5*a*Math.sin(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*u+a*(c*t.skew.z.y),f=s*c;var y=T.Math.xy2distDeg(h,l);y.deg+=t.rotation;var g=T.Math.distDeg2xy(y.dist,y.deg);h=g.x,l=g.y,e.points.push([n+h,r+l,i+f]),0===c&&(e.polygons[0].push(p+1),e.polygons[1].push(p+1+t.shape.n),e.polygons2D[0].push(p+1),e.polygons2D[1].push(p+1+t.shape.n),e.polygons.push([0!==p?p:t.shape.n,p+1,p+1+t.shape.n,(0!==p?p:t.shape.n)+t.shape.n]))}}return e},e.get2Dlines=function(t,e){var n=this.get3D(t),r=[],i=[n.polygons2D[e]];for(var o in i)for(var a,s,u=-1,c=i[o].length;c-1>u;u++)a=-1!=u?u:c-1,s=u+1,a=n.points[i[o][a]-1],s=n.points[i[o][s]-1],r.push([{x:a[0],y:a[1]},{x:s[0],y:s[1]}]);return r},e.collisionLinesDetect=function(t,e){for(var n in t)for(var r in e)if(T.Math.lineCollision(t[n][0].x,t[n][0].y,t[n][1].x,t[n][1].y,e[r][0].x,e[r][0].y,e[r][1].x,e[r][1].y))return!0;return!1},e.collision2D=function(t,e){var n=Particles.get2Dlines(t,1),r=Particles.get2Dlines(e,0),o=Particles.collisionLinesDetect(n,r);return o||(o=function(){var t,e,o=100;for(i=0;i<2;i++){0===i?(t=JSON.parse(JSON.stringify(r)),e=n[0]):(t=JSON.parse(JSON.stringify(n)),e=r[0]);var a=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(e)),u=e[1].x-e[0].x,c=e[1].y-e[0].y;a[0].x-=u*o,a[0].y-=c*o,s[1].x+=u*o,s[1].y+=c*o,a=[a],s=[s];var h=Particles.collisionLinesDetect(a,t),l=Particles.collisionLinesDetect(s,t);if(h&&l)return!0}return!1}()),o},MIXIN$0(t,e),e=void 0,t}(),T.setNamespace("Objects"),T.Objects.Array=function(){"use strict";function t(t){this.objects=[],t instanceof Array&&t.forEach(this.push,this)}var e={},n={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.getAll=function(){return this.objects},n.forEach=function(){return this.objects.forEach.apply(this.objects,arguments)},e.initInstance=function(t){if("building"==t.type)t=new T.Objects.Building(t);else if("terrain"==t.type)t=new T.Objects.Terrain(t);else if("story"==t.type)t=new T.Objects.Story(t);else{if("natural"!=t.type)throw console.log(t),new Error("Cant put item into Towns Objects Array because of unrecognized object type "+t.type);t=new T.Objects.Natural(t)}return t},n.push=function(t){return this.objects.push(T.Objects.Array.initInstance(t))},n.update=function(t){this.setById(t.id,t)||this.push(t)},n.getById=function(t){if("string"!=typeof t)throw new Error("getById: id should be string");for(var e in this.objects)if(this.objects[e].id==t)return this.objects[e];return null},n.setById=function(t,e){if("string"!=typeof t)throw new Error("setById: id should be string");for(var n in this.objects)if(this.objects[n].id==t)return this.objects[n]=T.Objects.Array.initInstance(e),!0;return!1},n.removeId=function(t,e){if("string"!=typeof t)throw new Error("removeId: id should be string");for(var n in this.objects)if(this.objects[n].id==t)return this.objects.splice(n,1),!0;return!1},n.filterTypes=function(){var t=new T.Objects.Array,e=Array.prototype.slice.call(arguments);return this.forEach(function(n){-1!=e.indexOf(n.type)&&t.push(n)}),t},n.getMapOfTerrainCodes=function(t,e){var n,r,i=[];for(r=0;2*e>r;r++)for(i[r]=[],n=0;2*e>n;n++)i[r][n]=!1;for(var o,a=this.filterTypes("terrain").getAll(),s=0,u=a.length;u>s;s++)if(o=a[s],1==o.design.data.size)n=Math.floor(o.x-t.x+e),r=Math.floor(o.y-t.y+e),i[r][n]=o.getCode();else{var c=Math.floor(o.x-t.x+e-o.design.data.size),h=Math.ceil(o.x-t.x+e+o.design.data.size),l=Math.floor(o.y-t.y+e-o.design.data.size),f=Math.ceil(o.y-t.y+e+o.design.data.size),p=o.x-t.x+e,d=o.y-t.y+e;for(r=l;f>=r;r++)if("undefined"!=typeof i[r])for(n=c;h>=n;n++)"undefined"!=typeof i[r][n]&&T.Math.xy2dist(n-p,r-d)<=o.design.data.size&&(i[r][n]=o.getCode())}return i},n.get1x1TerrainObjects=function(){for(var t,e,n,r=new T.Objects.Array,i=this.filterTypes("terrain").getAll().slice().reverse(),o={},a=0,s=i.length;s>a;a++)if(n=i[a],1==n.design.data.size)t=n,e="x"+Math.round(t.x)+"y"+Math.round(t.y),"undefined"==typeof o[e]&&(o[e]=!0,r.push(t));else for(var u=Math.floor(-n.design.data.size),c=Math.ceil(n.design.data.size),h=Math.floor(-n.design.data.size),l=Math.ceil(n.design.data.size),f=h;l>=f;f++)for(var p=u;c>=p;p++)T.Math.xy2dist(p,f)<=n.design.data.size&&(t=n.clone(),t.design.data.size=1,t.x=Math.round(t.x+p),t.y=Math.round(t.y+f),e="x"+t.x+"y"+t.y,"undefined"==typeof o[e]&&(o[e]=!0,r.push(t)));return r},n.getTerrainOnPosition=function(t){for(var e=this.objects.length-1;e>=0;e--)if("terrain"==this.objects[e].type&&this.objects[e].design.data.size<=t.getDistance(new T.Position(this.objects[e].x,this.objects[e].y)))return this.objects[e];return null},n.getNearestTerrainPositionWithCode=function(t,e){var n=this.get1x1TerrainObjects(),r=-1,i=!1;return n.forEach(function(e){var n=e.getPosition().getDistance(t);(-1===r||r>n)&&(r=n,i=e)}),i===!1?null:i.getPosition()},MIXIN$0(t,e),MIXIN$0(t.prototype,n),e=n=void 0,t}(),T.Objects.Object=function(){"use strict";function t(t){for(var e in t){var n=e;"_id"==n&&(n="id"),this[n]=t[e]}}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getPosition=function(){return new T.Position(this.x,this.y)},e.toString=function(){return"["+this.name+"]"},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Objects.Building=function(t){"use strict";function e(e){if(t.call(this,e),"undefined"==typeof this.actions)this.actions=[];else{for(var n=[],r=0,i=this.actions.length;i>r;r++)try{n.push(T.World.game.newActionInstance(this.actions[r]))}catch(o){console.warn(o)}this.actions=n}var a=this.getAction("life"),s=T.World.game.getObjectMaxLife(this);null==a?(a=T.World.game.newActionInstance({type:"life",params:{life:s,max_life:s}}),n.push(a)):a.params.max_life=s}t=T.Objects.Object,PRS$0||MIXIN$0(e,t);var n={};return null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.clone=function(){return new T.Objects.Building(JSON.parse(JSON.stringify(this)))},n.getModel=function(){return this.design.data instanceof T.Model||(this.design.data=new T.Model(this.design.data)),this.design.data},n.getAction=function(t){for(var e=0,n=this.actions.length;n>e;e++)if(this.actions[e].type==t)return this.actions[e];return null},n.createHtmlProfile=function(){for(var t="",e=0,n=this.actions.length;n>e;e++)t+=this.actions[e].createHtmlProfile();return'\n\n            <div class="object-building-profile">\n\n                <h2>'+this.name+"</h2>\n\n\n                "+t+"\n\n\n\n            </div>\n\n        "},MIXIN$0(e.prototype,n),n=void 0,e}(),T.Objects.Natural=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Objects.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={};return n.clone=function(){return new T.Objects.Natural(JSON.parse(JSON.stringify(this)))},n.getCode=function(){return this.design.data.image},MIXIN$0(e.prototype,n),n=void 0,e}(),T.Objects.Story=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Objects.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{
constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={};return n.clone=function(){return new T.Objects.Story(JSON.parse(JSON.stringify(this)))},n.getMarkdown=function(){return this.content.data},MIXIN$0(e.prototype,n),n=void 0,e}(),T.Objects.Terrain=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Objects.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={};return n.clone=function(){return new T.Objects.Terrain(JSON.parse(JSON.stringify(this)))},n.getCode=function(t){return this.design.data.image},n.getColor=function(){return this.design.data.color},MIXIN$0(e.prototype,n),n=void 0,e}(),T.Resources=function(){"use strict";function t(t){for(var e in t)"number"==typeof t[e]&&(this[e]=Math.ceil(t[e]))}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.clone=function(){return new T.Resources(this)},e.contains=function(t){for(var e in t){if("number"==typeof this[e])return!1;if(this[e]<t[e])return!1}return!0},e.add=function(t){for(var e in t)"undefined"==typeof this[e]&&(this[e]=0),"number"==typeof this[e]&&(this[e]+=t[e]);return this},e.multiply=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]=Math.ceil(this[e]*t));return this},e.signum=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]>0?this[e]=1:this[e]=0);return this},e.apply=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]=t(this[e]));return this},e.extractKeys=function(){var t=[];for(var e in this)"number"==typeof this[e]&&t.push(e);return t},e.compare=function(t){var e=this,n=t,r=[];r=r.concat(e.extractKeys()),r=r.concat(n.extractKeys()),r=r.filter(function(t,e,n){return n.indexOf(t)===e});var i=0;for(var o in r){var a=r[o],s=e[a],u=n[a];"undefined"==typeof s&&(s=0),"undefined"==typeof u&&(u=0),i+=Math.pow(s-u,2)}return i=Math.sqrt(i)},e.remove=function(t){if(!this.contains(t))return!1;for(var e in t)this[e]-=t[e];return!0},e.toString=function(){var t=[];for(var e in this)"number"==typeof this[e]&&0!==this[e]&&t.push(this[e]+" "+e);return t.join(", ")},e.toHTML=function(){var t=[];for(var e in this)if("number"==typeof this[e]&&0!==this[e]){var n=T.Locale.get("resource",e),r=this[e];r=r.toLocaleString(),t.push('<div><img src="/media/image/resources/'+e+'.png" title="'+n+'" alt="'+n+'" >'+r+"</div>")}return t=t.join(" "),t='<div class="resources">'+t+"</div>"},MIXIN$0(t.prototype,e),e=void 0,t}(),T.User=function(){"use strict";function t(t){for(var e in t){var n=e;this[n]=t[e]}}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getSignatureHTML=function(){var t;t=this.profile.name||this.profile.surname?this.profile.name+" "+this.profile.surname:this.profile.username;var e=md5(this.profile.email),n='\n\n                <div class="user-signature">\n                    <img class="user-image" src="https://1.gravatar.com/avatar/'+e+'?s=80&r=pg&d=mm">\n\n                    <div class="user-signature-text">\n                        <h1 class="user-name">'+t+"</h1>\n                        <p>"+this.profile.signature.html2text()+"</p>\n                    </div>\n\n                </div>\n\n            ";return n},MIXIN$0(t.prototype,e),e=void 0,t}(),T.setNamespace("World"),T.World.terrains=[new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:0,color:"#000000",size:1}},name:"temnota"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:1,color:"#337EFA",size:1}},name:"moře"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:2,color:"#545454",size:1}},name:"dlažba"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:3,color:"#EFF7FB",size:1}},name:"sníh/led"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:4,color:"#F9F98D",size:1}},name:"písek"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:5,color:"#878787",size:1}},name:"kamení"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:6,color:"#5A2F00",size:1}},name:"hlína"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:7,color:"#EFF7FB",size:1}},name:"sníh/led"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:8,color:"#2A7302",size:1}},name:"tráva(normal)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:9,color:"#51F311",size:1}},name:"tráva(toxic)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:10,color:"#535805",size:1}},name:"les"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:11,color:"#6aa2ff",size:1}},name:"řeka"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:12,color:"#8ABC02",size:1}},name:"tráva(jaro)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:13,color:"#8A9002",size:1}},name:"tráva(pozim)"})],T.World.mapGenerator=new T.MapGenerator(T.Math.blurXY(function(t,e){for(var n,r,i=100,o=0,a=0,s=.4,u=1-s,c=0;11>c;c++)o+=Math.round(Math.pow(t*e-66,2))%(i+1),a+=i,n=-e*s+t*u,r=t*s+e*u,t=Math.floor(n/4),e=Math.floor(r/4);return o/=a,0>o&&(o-=Math.floor(o)),o>1&&(o-=Math.floor(o)),o},2),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,2e-4,3e-4,3e-4,5e-4,6e-4,7e-4,9e-4,.001,.001,.001,.0012,.0014,.0015,.0016,.0021,.0025,.003,.0033,.0034,.0037,.0038,.0042,.0046,.0049,.0057,.0065,.0068,.0072,.0074,.0079,.0084,.009,.0096,.0105,.0115,.0123,.0131,.0142,.0148,.0159,.0166,.0184,.019,.0204,.021,.022,.0232,.0245,.026,.0266,.0277,.029,.0297,.031,.0318,.0331,.0346,.0361,.0378,.0389,.0404,.0414,.0431,.0456,.0475,.0501,.0517,.0533,.0548,.0566,.0589,.0609,.0622,.0635,.0658,.0678,.0692,.0712,.0733,.0751,.0774,.079,.0813,.0837,.0859,.088,.0902,.0927,.0961,.0988,.1003,.1031,.105,.1071,.11,.1113,.1137,.1165,.1187,.1218,.1243,.1277,.1297,.1323,.1353,.1371,.1395,.1426,.1449,.1474,.1509,.1536,.156,.1582,.1605,.1633,.1662,.1692,.1726,.1755,.1781,.1813,.1842,.1869,.1899,.1939,.1975,.2001,.2029,.207,.2108,.2135,.2158,.2187,.221,.2238,.226,.2283,.2326,.2362,.2394,.2427,.2455,.2485,.2508,.2532,.2568,.2594,.2628,.2651,.2678,.2712,.2738,.276,.2792,.2819,.2852,.2885,.2908,.2943,.2969,.2994,.3019,.3049,.3077,.3108,.3135,.3162,.3194,.3216,.3243,.3276,.3307,.3334,.336,.3386,.3421,.3443,.3462,.3484,.351,.3535,.3569,.3593,.3618,.3642,.3659,.3681,.3706,.3722,.3742,.3772,.3794,.3816,.3837,.3865,.3879,.3907,.3925,.3947,.3967,.3985,.3998,.4021,.4035,.4054,.4067,.4088,.4107,.4133,.4141,.4161,.4177,.4193,.4209,.4219,.4234,.4245,.4264,.4283,.4302,.4318,.4327,.4346,.4363,.4381,.44,.4409,.4435,.445,.4462,.4484,.4492,.4506,.4518,.4533,.4548,.4554,.456,.4573,.4588,.4605,.4616,.463,.4638,.4656,.4663,.4672,.4684,.4696,.4708,.4721,.473,.4737,.4747,.4756,.4765,.4781,.4791,.4802,.4809,.4819,.4824,.483,.4838,.4847,.4859,.4865,.487,.4875,.4883,.4894,.4901,.4907,.4915,.4929,.4934,.494,.4949,.4955,.496,.4967,.4971,.4975,.4981,.499,.4997,.5005,.5008,.5018,.5024,.5032,.5038,.5042,.5046,.505,.5059,.5067,.507,.5074,.5077,.5084,.5086,.5095,.5104,.5109,.5117,.5122,.5129,.5136,.514,.5141,.5145,.515,.5153,.5157,.5162,.5169,.5172,.5176,.518,.5186,.5193,.5197,.5202,.5207,.5209,.5214,.5218,.5223,.5231,.5237,.5244,.5246,.5249,.5259,.5261,.5269,.5272,.5275,.5281,.5283,.5285,.5291,.5302,.531,.5317,.532,.5326,.5334,.5336,.5341,.5343,.5345,.5349,.5353,.5357,.5364,.5377,.5382,.5388,.5393,.5399,.5403,.5412,.5419,.543,.5437,.5446,.5457,.5466,.5476,.5482,.5486,.5491,.5495,.5503,.5506,.5515,.5522,.5527,.554,.555,.5553,.5557,.5562,.5569,.5578,.5586,.5595,.5608,.5616,.5626,.5634,.5645,.5652,.5667,.5673,.5683,.5697,.5707,.5723,.5739,.575,.5758,.5771,.5779,.5791,.5803,.5817,.5833,.5849,.5865,.5876,.5884,.5899,.5919,.5929,.5942,.5954,.5969,.5987,.5998,.6018,.6036,.6052,.6063,.6077,.6099,.6116,.6136,.6154,.6166,.6185,.6201,.6223,.6238,.6258,.6278,.6295,.631,.6324,.6344,.6358,.6372,.6395,.6414,.6434,.6451,.6472,.6493,.6513,.6536,.6559,.6578,.6598,.6622,.6638,.667,.6696,.671,.674,.6765,.679,.6811,.6836,.6861,.6884,.6903,.6933,.6946,.6976,.6997,.7027,.7049,.7084,.7109,.7128,.7164,.7189,.7222,.7245,.7271,.7305,.7326,.7367,.7398,.7421,.7443,.7461,.7483,.7507,.754,.7566,.7587,.7615,.7639,.7662,.7693,.7723,.7753,.7769,.7797,.7822,.7843,.7869,.7891,.7918,.7944,.7982,.801,.8041,.8068,.8094,.812,.8148,.8174,.82,.8219,.824,.8259,.8287,.8311,.8333,.8349,.8374,.841,.8433,.8456,.8481,.8518,.854,.8562,.8588,.862,.864,.8666,.8693,.8719,.8737,.8749,.8773,.8793,.8816,.8839,.887,.8888,.8905,.8924,.8948,.8966,.8986,.9009,.9029,.9039,.9063,.908,.9095,.911,.9125,.915,.9173,.9186,.9209,.9228,.9249,.9259,.927,.929,.9303,.9322,.9332,.9343,.9356,.9372,.9387,.9407,.9427,.944,.9459,.9473,.949,.9508,.9521,.9533,.9555,.9569,.958,.9592,.9606,.9612,.9617,.962,.9627,.9642,.9646,.9658,.967,.968,.9684,.9688,.9698,.9706,.9719,.9727,.974,.9747,.9761,.9774,.9785,.9793,.9802,.9811,.9817,.9823,.9828,.984,.9846,.9851,.9858,.9863,.9869,.987,.9874,.9879,.9886,.9888,.9895,.9903,.9904,.9907,.9912,.9913,.9917,.992,.9928,.9929,.9936,.9939,.9942,.9946,.9949,.9955,.9955,.9959,.9963,.9964,.9966,.9966,.9968,.9969,.9971,.9973,.9978,.9981,.9985,.9986,.9988,.9988,.9989,.9989,.999,.999,.999,.9993,.9993,.9993,.9993,.9993,.9993,.9996,.9996,.9997,.9997,.9997,.9998,.9999,.9999,.9999,.9999,.9999,.9999,.9999,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],new T.MapGenerator.Biotope([{amount:120,terrain:T.World.terrains[1]},{amount:40,terrain:T.World.terrains[11]},{amount:30,terrain:T.World.terrains[4]},{amount:20,terrain:T.World.terrains[12]},{amount:40,terrain:T.World.terrains[9]},{amount:20,terrain:T.World.terrains[10]},{amount:10,terrain:T.World.terrains[8]},{amount:20,terrain:T.World.terrains[10]},{amount:20,terrain:T.World.terrains[12]},{amount:50,terrain:T.World.terrains[4]},{amount:10,terrain:T.World.terrains[13]},{amount:20,terrain:T.World.terrains[5]},{amount:60,terrain:T.World.terrains[3]},{amount:5,terrain:T.World.terrains[10]},{amount:60,terrain:T.World.terrains[7]},{amount:10,terrain:T.World.terrains[5]}]),function(t,e){"terrain"==t.type&&(5==t.getCode()?e.push({x:t.x,y:t.y,type:"natural",design:{type:"natural",data:{image:"rock"+Math.floor(6*T.Math.randomSeedPosition(1,{x:t.x,y:t.y}))%6+"dark"+Math.floor(4*T.Math.randomSeedPosition(2,{x:t.x,y:t.y}))%4,size:.5+1*T.Math.randomSeedPosition(5,{x:t.x,y:t.y})}}}):10==t.getCode()&&e.push({x:t.x,y:t.y,type:"natural",design:{type:"natural",data:{image:"tree"+Math.floor(10*T.Math.randomSeedPosition(3,{x:t.x,y:t.y}))%10,size:1+T.Math.randomSeedPosition(6,{x:t.x,y:t.y})/2}}}))}),T.World.game=new T.Game(T.Math.prettyNumber,T.Math.prettyNumber),T.World.game.installActionClass({distance:0,strength:0,rounds:1,cooldown:1},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},i={};return n.getType=function(){return"attack"},i.countPriceBase=function(){return Math.pow(this.params.distance,2)*this.params.strength*this.params.rounds*(1/this.params.cooldown)*100*.05},i.getPriceResources=function(){return[new T.Resources({wood:2}),new T.Resources({stone:3}),new T.Resources({iron:2})]},n.execute=function(t,e,n,i){var o=e.getAction("attack"),a=e.getAction("defence"),s=n.getAction("attack"),u=n.getAction("defence"),c=e.getAction("life").params,h=n.getAction("life").params;if(!(o instanceof T.Game.Action))throw new Error("Attacker has not ability to attack");o=o.clone().params,a=a instanceof T.Game.Action?a.clone().params:t.getActionEmptyInstance("defence").params,s=s instanceof T.Game.Action?s.clone().params:t.getActionEmptyInstance("attack").params,u=u instanceof T.Game.Action?u.clone().params:t.getActionEmptyInstance("defence").params;var l=e.getPosition().getDistance(n.getPosition());if(l>o.distance)throw new Error("Objects are too far - "+l+" fields. Attack distance is only "+o.distance+" fields.");if(!e.getAction("attack").canBeExecutedNow())throw new Error("This action can be executed in "+e.getAction("attack").canBeExecutedIn()+" seconds.");for(e.getAction("attack").nowExecuted(),r("attack",o.strength,s.strength),r("defence",a.defence,u.defence),o.strength-=u.defence,o.strength<0&&(o.strength=0),s.strength-=a.defence,s.strength<0&&(s.strength=0);(o.rounds||s.rounds)&&c.life>1&&h.life>1;)r("round",o.strength,s.strength),r("life",h.life,c.life),h.life-=o.strength,c.life-=s.strength,o.rounds--,s.rounds--;c.life<1&&(c.life=1),h.life<1&&(h.life=1)},MIXIN$0(e,n),MIXIN$0(e.prototype,i),n=i=void 0,e}()),T.World.game.installActionClass({defence:0},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"defence"},r.countPriceBase=function(){return 800*this.params.defence*.05},r.getPriceResources=function(){return[new T.Resources({wood:2}),new T.Resources({clay:2}),new T.Resources({stone:1})]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({life:1,max_life:1},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"life"},r.countPriceBase=function(){return 0},r.getPriceResources=function(){return[new T.Resources]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({wood:0,iron:0,clay:0,stone:0},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"mine"},r.countPriceBase=function(){return 3600*this.params.amount*.05},r.getPriceResources=function(){return[new T.Resources({wood:3}),new T.Resources({clay:2}),new T.Resources({stone:2}),new T.Resources({iron:4})]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({speed:0},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"move"},r.countPriceBase=function(){return 10*Math.pow(this.params.speed,2)*.05},r.getPriceResources=function(){return[new T.Resources({wood:2}),new T.Resources({iron:1})]},n.execute=function(t,e,n,r,i){var o=e.getPosition();e.path=new T.Path(o,n,1)},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({regenerate:100},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"regenerate"},r.countPriceBase=function(){return 1/this.params.regenerate*3600*.05},r.getPriceResources=function(){return[new T.Resources({wood:4}),new T.Resources({clay:2}),new T.Resources({stone:2}),new T.Resources({iron:2})]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({repair:0},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"repair"},r.countPriceBase=function(){return 1/(this.params.repair/100)*1e3*.05},r.getPriceResources=function(){return[new T.Resources({wood:4}),new T.Resources({clay:2}),new T.Resources({stone:3}),new T.Resources({iron:4})]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}()),T.World.game.installActionClass({throughput:0},function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=T.Game.Action,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var n={},r={};return n.getType=function(){return"throughput"},r.countPriceBase=function(){return 10*Math.pow(this.params.throughput/100,2)*.05},r.getPriceResources=function(){return[new T.Resources({wood:2}),new T.Resources({clay:3}),new T.Resources({stone:1}),new T.Resources({iron:0})]},MIXIN$0(e,n),MIXIN$0(e.prototype,r),n=r=void 0,e}());